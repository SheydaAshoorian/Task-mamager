{
    "sourceFile": "apps/backend/src/auth/auth.guard.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 27,
            "patches": [
                {
                    "date": 1771439791836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1771443425093,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,10 +19,11 @@\n       throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n     }\n \n     try {\n-      const payload = await this.jwtService.verifyAsync(token, {\n-        secret: 'SUPER_SECRET_KEY', // دقیقاً همان پسوردی که در AuthModule دادی\n+const payload = await this.jwtService.verifyAsync(token, {\n+  secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n+});\n       });\n       \n       // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n       request['user'] = payload;\n"
                },
                {
                    "date": 1771443430563,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,11 +19,11 @@\n       throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n     }\n \n     try {\n-const payload = await this.jwtService.verifyAsync(token, {\n-  secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n-});\n+        const payload = await this.jwtService.verifyAsync(token, {\n+        secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n+        });\n       });\n       \n       // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n       request['user'] = payload;\n"
                },
                {
                    "date": 1771443436832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,11 +19,10 @@\n       throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n     }\n \n     try {\n-        const payload = await this.jwtService.verifyAsync(token, {\n-        secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n-        });\n+      const payload = await this.jwtService.verifyAsync(token, {\n+        secret: 'SUPER_SECRET_KEY', // دقیقاً همان پسوردی که در AuthModule دادی\n       });\n       \n       // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n       request['user'] = payload;\n"
                },
                {
                    "date": 1771443445011,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,11 +19,11 @@\n       throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n     }\n \n     try {\n-      const payload = await this.jwtService.verifyAsync(token, {\n-        secret: 'SUPER_SECRET_KEY', // دقیقاً همان پسوردی که در AuthModule دادی\n-      });\n+    const payload = await this.jwtService.verifyAsync(token, {\n+    secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n+    });\n       \n       // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n       request['user'] = payload;\n     } catch {\n"
                },
                {
                    "date": 1771505486822,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,39 @@\n+import {\n+  CanActivate,\n+  ExecutionContext,\n+  Injectable,\n+  UnauthorizedException,\n+} from '@nestjs/common';\n+import { JwtService } from '@nestjs/jwt';\n+import { Request } from 'express';\n+\n+@Injectable()\n+export class AuthGuard implements CanActivate {\n+  constructor(private jwtService: JwtService,) {}\n+\n+  async canActivate(context: ExecutionContext): Promise<boolean> {\n+    const request = context.switchToHttp().getRequest();\n+    const token = this.extractTokenFromHeader(request);\n+\n+    if (!token) {\n+      throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n+    }\n+\n+    try {\n+        const payload = await this.jwtService.verifyAsync(token, {\n+        secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n+        });\n+      \n+      // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n+      request['user'] = payload;\n+    } catch {\n+      throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n+    }\n+    return true;\n+  }\n+\n+  private extractTokenFromHeader(request: Request): string | undefined {\n+    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n+    return type === 'Bearer' ? token : undefined;\n+  }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771505499384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,12 @@\n import { Request } from 'express';\n \n @Injectable()\n export class AuthGuard implements CanActivate {\n-  constructor(private jwtService: JwtService,) {}\n+  constructor(private jwtService: JwtService,\n+    @Inject(forwardRef(() => UsersService)) \n+    private usersService: UsersService,\n+  ) {}\n \n   async canActivate(context: ExecutionContext): Promise<boolean> {\n     const request = context.switchToHttp().getRequest();\n     const token = this.extractTokenFromHeader(request);\n@@ -35,44 +38,5 @@\n   private extractTokenFromHeader(request: Request): string | undefined {\n     const [type, token] = request.headers.authorization?.split(' ') ?? [];\n     return type === 'Bearer' ? token : undefined;\n   }\n-}\n-import {\n-  CanActivate,\n-  ExecutionContext,\n-  Injectable,\n-  UnauthorizedException,\n-} from '@nestjs/common';\n-import { JwtService } from '@nestjs/jwt';\n-import { Request } from 'express';\n-\n-@Injectable()\n-export class AuthGuard implements CanActivate {\n-  constructor(private jwtService: JwtService) {}\n-\n-  async canActivate(context: ExecutionContext): Promise<boolean> {\n-    const request = context.switchToHttp().getRequest();\n-    const token = this.extractTokenFromHeader(request);\n-\n-    if (!token) {\n-      throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n-    }\n-\n-    try {\n-    const payload = await this.jwtService.verifyAsync(token, {\n-    secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n-    });\n-      \n-      // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n-      request['user'] = payload;\n-    } catch {\n-      throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n-    }\n-    return true;\n-  }\n-\n-  private extractTokenFromHeader(request: Request): string | undefined {\n-    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n-    return type === 'Bearer' ? token : undefined;\n-  }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771505509174,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,8 +11,10 @@\n export class AuthGuard implements CanActivate {\n   constructor(private jwtService: JwtService,\n     @Inject(forwardRef(() => UsersService)) \n     private usersService: UsersService,\n+    private configService: ConfigService,\n+\n   ) {}\n \n   async canActivate(context: ExecutionContext): Promise<boolean> {\n     const request = context.switchToHttp().getRequest();\n"
                },
                {
                    "date": 1771505551374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,10 @@\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n   UnauthorizedException,\n+import { Module, forwardRef } from '@nestjs/common';\n+\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n \n"
                },
                {
                    "date": 1771505559365,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,10 +2,9 @@\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n   UnauthorizedException,\n-import { Module, forwardRef } from '@nestjs/common';\n-\n+  \n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n \n"
                },
                {
                    "date": 1771505568553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,11 @@\n import {\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n+import { Module, forwardRef } from '@nestjs/common';\n+\n   UnauthorizedException,\n-  \n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n \n"
                },
                {
                    "date": 1771505584979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,9 @@\n import {\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n-import { Module, forwardRef } from '@nestjs/common';\n-\n+  forwardRef\n   UnauthorizedException,\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n"
                },
                {
                    "date": 1771505609622,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,14 +1,16 @@\n import {\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n-  forwardRef\n+  forwardRef,\n   UnauthorizedException,\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n+import { UsersService } from './users.service';\n \n+\n @Injectable()\n export class AuthGuard implements CanActivate {\n   constructor(private jwtService: JwtService,\n     @Inject(forwardRef(() => UsersService)) \n"
                },
                {
                    "date": 1771505616703,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n   UnauthorizedException,\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n-import { UsersService } from './users.service';\n+import { UsersService } from '../users.service';\n \n \n @Injectable()\n export class AuthGuard implements CanActivate {\n"
                },
                {
                    "date": 1771505625421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n   UnauthorizedException,\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n-import { UsersService } from '../users.service';\n+import { UsersService } from '../users/users.service';\n \n \n @Injectable()\n export class AuthGuard implements CanActivate {\n"
                },
                {
                    "date": 1771505671010,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,9 +14,8 @@\n export class AuthGuard implements CanActivate {\n   constructor(private jwtService: JwtService,\n     @Inject(forwardRef(() => UsersService)) \n     private usersService: UsersService,\n-    private configService: ConfigService,\n \n   ) {}\n \n   async canActivate(context: ExecutionContext): Promise<boolean> {\n"
                },
                {
                    "date": 1771505682337,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n   forwardRef,\n-  UnauthorizedException,\n+  UnauthorizedException,@Inject\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n import { UsersService } from '../users/users.service';\n"
                },
                {
                    "date": 1771505704174,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n   forwardRef,\n-  UnauthorizedException,@Inject\n+  UnauthorizedException,Inject,\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n import { UsersService } from '../users/users.service';\n"
                },
                {
                    "date": 1771505709982,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n   CanActivate,\n   ExecutionContext,\n   Injectable,\n   forwardRef,\n-  UnauthorizedException,Inject,\n+  UnauthorizedException,Inject\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n import { UsersService } from '../users/users.service';\n"
                },
                {
                    "date": 1771509641043,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,48 @@\n+import {\n+  CanActivate,\n+  ExecutionContext,\n+  Injectable,\n+  forwardRef,\n+  UnauthorizedException,\n+  Inject\n+} from '@nestjs/common';\n+import { JwtService } from '@nestjs/jwt';\n+import { Request } from 'express';\n+import { UsersService } from '../users/users.service';\n+\n+\n+@Injectable()\n+export class AuthGuard implements CanActivate {\n+  constructor(\n+    private jwtService: JwtService,\n+    @Inject(forwardRef(() => UsersService)) \n+    private usersService: UsersService,\n+\n+  ) {}\n+\n+  async canActivate(context: ExecutionContext): Promise<boolean> {\n+    const request = context.switchToHttp().getRequest();\n+    const token = this.extractTokenFromHeader(request);\n+\n+    if (!token) {\n+      throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n+    }\n+\n+    try {\n+        const payload = await this.jwtService.verifyAsync(token, {\n+        secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n+        });\n+      \n+      // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n+      request['user'] = payload;\n+    } catch {\n+      throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n+    }\n+    return true;\n+  }\n+\n+  private extractTokenFromHeader(request: Request): string | undefined {\n+    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n+    return type === 'Bearer' ? token : undefined;\n+  }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771509658903,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,8 +16,9 @@\n   constructor(\n     private jwtService: JwtService,\n     @Inject(forwardRef(() => UsersService)) \n     private usersService: UsersService,\n+    private configService: ConfigService,\n \n   ) {}\n \n   async canActivate(context: ExecutionContext): Promise<boolean> {\n@@ -44,51 +45,5 @@\n   private extractTokenFromHeader(request: Request): string | undefined {\n     const [type, token] = request.headers.authorization?.split(' ') ?? [];\n     return type === 'Bearer' ? token : undefined;\n   }\n-}\n-import {\n-  CanActivate,\n-  ExecutionContext,\n-  Injectable,\n-  forwardRef,\n-  UnauthorizedException,Inject\n-} from '@nestjs/common';\n-import { JwtService } from '@nestjs/jwt';\n-import { Request } from 'express';\n-import { UsersService } from '../users/users.service';\n-\n-\n-@Injectable()\n-export class AuthGuard implements CanActivate {\n-  constructor(private jwtService: JwtService,\n-    @Inject(forwardRef(() => UsersService)) \n-    private usersService: UsersService,\n-\n-  ) {}\n-\n-  async canActivate(context: ExecutionContext): Promise<boolean> {\n-    const request = context.switchToHttp().getRequest();\n-    const token = this.extractTokenFromHeader(request);\n-\n-    if (!token) {\n-      throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n-    }\n-\n-    try {\n-        const payload = await this.jwtService.verifyAsync(token, {\n-        secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n-        });\n-      \n-      // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n-      request['user'] = payload;\n-    } catch {\n-      throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n-    }\n-    return true;\n-  }\n-\n-  private extractTokenFromHeader(request: Request): string | undefined {\n-    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n-    return type === 'Bearer' ? token : undefined;\n-  }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771509779337,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,9 @@\n } from '@nestjs/common';\n import { JwtService } from '@nestjs/jwt';\n import { Request } from 'express';\n import { UsersService } from '../users/users.service';\n+import { ConfigService } from '@nestjs/config';\n \n \n @Injectable()\n export class AuthGuard implements CanActivate {\n"
                },
                {
                    "date": 1771509818177,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,8 +15,9 @@\n @Injectable()\n export class AuthGuard implements CanActivate {\n   constructor(\n     private jwtService: JwtService,\n+    \n     @Inject(forwardRef(() => UsersService)) \n     private usersService: UsersService,\n     private configService: ConfigService,\n \n"
                },
                {
                    "date": 1771510551796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,11 +15,11 @@\n @Injectable()\n export class AuthGuard implements CanActivate {\n   constructor(\n     private jwtService: JwtService,\n-    \n-    @Inject(forwardRef(() => UsersService)) \n-    private usersService: UsersService,\n+\n+@Inject(forwardRef(() => UsersService))    private usersService: UsersService,\n+\n     private configService: ConfigService,\n \n   ) {}\n \n"
                },
                {
                    "date": 1771510559463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,9 +16,10 @@\n export class AuthGuard implements CanActivate {\n   constructor(\n     private jwtService: JwtService,\n \n-@Inject(forwardRef(() => UsersService))    private usersService: UsersService,\n+  @Inject(forwardRef(() => UsersService))\n+    private usersService: UsersService,\n \n     private configService: ConfigService,\n \n   ) {}\n"
                },
                {
                    "date": 1771510948282,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,52 +1,52 @@\n-import {\n-  CanActivate,\n-  ExecutionContext,\n-  Injectable,\n-  forwardRef,\n-  UnauthorizedException,\n-  Inject\n-} from '@nestjs/common';\n-import { JwtService } from '@nestjs/jwt';\n-import { Request } from 'express';\n-import { UsersService } from '../users/users.service';\n-import { ConfigService } from '@nestjs/config';\n+// import {\n+//   CanActivate,\n+//   ExecutionContext,\n+//   Injectable,\n+//   forwardRef,\n+//   UnauthorizedException,\n+//   Inject\n+// } from '@nestjs/common';\n+// import { JwtService } from '@nestjs/jwt';\n+// import { Request } from 'express';\n+// import { UsersService } from '../users/users.service';\n+// import { ConfigService } from '@nestjs/config';\n \n \n-@Injectable()\n-export class AuthGuard implements CanActivate {\n-  constructor(\n-    private jwtService: JwtService,\n+// @Injectable()\n+// export class AuthGuard implements CanActivate {\n+//   constructor(\n+//     private jwtService: JwtService,\n \n-  @Inject(forwardRef(() => UsersService))\n-    private usersService: UsersService,\n+//     @Inject(forwardRef(() => UsersService))\n+//     private usersService: UsersService,\n \n-    private configService: ConfigService,\n+//     private configService: ConfigService,\n \n-  ) {}\n+//   ) {}\n \n-  async canActivate(context: ExecutionContext): Promise<boolean> {\n-    const request = context.switchToHttp().getRequest();\n-    const token = this.extractTokenFromHeader(request);\n+//   async canActivate(context: ExecutionContext): Promise<boolean> {\n+//     const request = context.switchToHttp().getRequest();\n+//     const token = this.extractTokenFromHeader(request);\n\\ No newline at end of file\n \n-    if (!token) {\n-      throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n-    }\n+//     if (!token) {\n+//       throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n+//     }\n \n-    try {\n-        const payload = await this.jwtService.verifyAsync(token, {\n-        secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n-        });\n+//     try {\n+//         const payload = await this.jwtService.verifyAsync(token, {\n+//         secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n+//         });\n       \n-      // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n-      request['user'] = payload;\n-    } catch {\n-      throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n-    }\n-    return true;\n-  }\n+//       // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n+//       request['user'] = payload;\n+//     } catch {\n+//       throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n+//     }\n+//     return true;\n+//   }\n \n-  private extractTokenFromHeader(request: Request): string | undefined {\n-    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n-    return type === 'Bearer' ? token : undefined;\n-  }\n-}\n+//   private extractTokenFromHeader(request: Request): string | undefined {\n+//     const [type, token] = request.headers.authorization?.split(' ') ?? [];\n+//     return type === 'Bearer' ? token : undefined;\n+//   }\n+// }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771511304284,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,52 +0,0 @@\n-// import {\n-//   CanActivate,\n-//   ExecutionContext,\n-//   Injectable,\n-//   forwardRef,\n-//   UnauthorizedException,\n-//   Inject\n-// } from '@nestjs/common';\n-// import { JwtService } from '@nestjs/jwt';\n-// import { Request } from 'express';\n-// import { UsersService } from '../users/users.service';\n-// import { ConfigService } from '@nestjs/config';\n-\n-\n-// @Injectable()\n-// export class AuthGuard implements CanActivate {\n-//   constructor(\n-//     private jwtService: JwtService,\n-\n-//     @Inject(forwardRef(() => UsersService))\n-//     private usersService: UsersService,\n-\n-//     private configService: ConfigService,\n-\n-//   ) {}\n-\n-//   async canActivate(context: ExecutionContext): Promise<boolean> {\n-//     const request = context.switchToHttp().getRequest();\n-//     const token = this.extractTokenFromHeader(request);\n-\n-//     if (!token) {\n-//       throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n-//     }\n-\n-//     try {\n-//         const payload = await this.jwtService.verifyAsync(token, {\n-//         secret: process.env.JWT_SECRET || 'fallbackSecret', // حتماً باید با ماژول یکی باشد\n-//         });\n-      \n-//       // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n-//       request['user'] = payload;\n-//     } catch {\n-//       throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n-//     }\n-//     return true;\n-//   }\n-\n-//   private extractTokenFromHeader(request: Request): string | undefined {\n-//     const [type, token] = request.headers.authorization?.split(' ') ?? [];\n-//     return type === 'Bearer' ? token : undefined;\n-//   }\n-// }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771524745951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,52 @@\n+import { \n+  CanActivate, \n+  ExecutionContext, \n+  Injectable, \n+  UnauthorizedException \n+} from '@nestjs/common';\n+import { ModuleRef } from '@nestjs/core'; // ۱. این رو ایمپورت کن\n+import { JwtService } from '@nestjs/jwt';\n+import { ConfigService } from '@nestjs/config';\n+import { UsersService } from '../users/users.service';\n+\n+@Injectable()\n+export class AuthGuard implements CanActivate {\n+  private usersService: UsersService; // ۲. اینجا تعریفش کن\n+\n+  constructor(\n+    private jwtService: JwtService,\n+    private configService: ConfigService,\n+    private moduleRef: ModuleRef, // ۳. فقط این رو تزریق کن\n+  ) {}\n+\n+async canActivate(context: ExecutionContext): Promise<boolean> {\n+  if (!this.usersService) {\n+    this.usersService = this.moduleRef.get(UsersService, { strict: false });\n+  }\n+\n+  const request = context.switchToHttp().getRequest();\n+  const token = this.extractTokenFromHeader(request);\n+\n+  if (!token) {\n+    throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n+  }\n+\n+  try {\n+    const payload = await this.jwtService.verifyAsync(token, {\n+      secret: this.configService.get('JWT_SECRET') || 'fallbackSecret',\n+    });\n+    \n+    // اطلاعات کاربر رو به ریکوئست اضافه می‌کنیم\n+    request['user'] = payload;\n+    \n+    return true; // <--- این اون خط طلایی هست که جا انداخته بودی!\n+  } catch {\n+    throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n+  }\n+}\n+\n+private extractTokenFromHeader(request: any): string | undefined {\n+  const [type, token] = request.headers.authorization?.split(' ') ?? [];\n+  return type === 'Bearer' ? token : undefined;\n+}\n+}\n\\ No newline at end of file\n"
                }
            ],
            "date": 1771439791836,
            "name": "Commit-0",
            "content": "import {\n  CanActivate,\n  ExecutionContext,\n  Injectable,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { JwtService } from '@nestjs/jwt';\nimport { Request } from 'express';\n\n@Injectable()\nexport class AuthGuard implements CanActivate {\n  constructor(private jwtService: JwtService) {}\n\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const request = context.switchToHttp().getRequest();\n    const token = this.extractTokenFromHeader(request);\n\n    if (!token) {\n      throw new UnauthorizedException('لطفاً ابتدا وارد حساب خود شوید');\n    }\n\n    try {\n      const payload = await this.jwtService.verifyAsync(token, {\n        secret: 'SUPER_SECRET_KEY', // دقیقاً همان پسوردی که در AuthModule دادی\n      });\n      \n      // اطلاعات کاربر را به شیء request اضافه می‌کنیم تا در Controller در دسترس باشد\n      request['user'] = payload;\n    } catch {\n      throw new UnauthorizedException('توکن شما معتبر نیست یا منقضی شده است');\n    }\n    return true;\n  }\n\n  private extractTokenFromHeader(request: Request): string | undefined {\n    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n    return type === 'Bearer' ? token : undefined;\n  }\n}"
        }
    ]
}