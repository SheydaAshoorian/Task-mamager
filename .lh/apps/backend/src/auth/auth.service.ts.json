{
    "sourceFile": "apps/backend/src/auth/auth.service.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 38,
            "patches": [
                {
                    "date": 1770977950256,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770980011681,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,9 @@\n import * as bcrypt from 'bcrypt';\n \n @Injectable()\n export class AuthService {\n+    \n   constructor(\n     private usersService: UsersService,\n     private jwtService: JwtService, // تزریق سرویس JWT\n   ) {}\n"
                },
                {
                    "date": 1770980061314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,12 +8,12 @@\n import * as bcrypt from 'bcrypt';\n \n @Injectable()\n export class AuthService {\n-    \n+\n   constructor(\n     private usersService: UsersService,\n-    private jwtService: JwtService, // تزریق سرویس JWT\n+    private jwtService: JwtService, \n   ) {}\n \n   async login(email: string, pass: string) {\n     // ۱. چک کردن یوزر و پسورد\n"
                },
                {
                    "date": 1770980068815,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,9 +15,9 @@\n     private jwtService: JwtService, \n   ) {}\n \n   async login(email: string, pass: string) {\n-    // ۱. چک کردن یوزر و پسورد\n+\n     const user = await this.usersService.findOneByEmail(email);\n     \n     if (!user) {\n        throw new UnauthorizedException('کاربر پیدا نشد');\n"
                },
                {
                    "date": 1770982353457,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,8 +23,9 @@\n        throw new UnauthorizedException('کاربر پیدا نشد');\n     }\n \n     const isMatch = await bcrypt.compare(pass, user.password);\n+    \n     if (!isMatch) {\n       throw new UnauthorizedException('رمز عبور اشتباه است');\n     }\n \n"
                },
                {
                    "date": 1770982407035,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,44 @@\n+import { Injectable } from '@nestjs/common';\n+\n+@Injectable()\n+export class AuthService {}\n+import { Injectable, UnauthorizedException } from '@nestjs/common';\n+import { UsersService } from '../users/users.service';\n+import { JwtService } from '@nestjs/jwt'; // اضافه کردن این\n+import * as bcrypt from 'bcrypt';\n+\n+@Injectable()\n+export class AuthService {\n+\n+  constructor(\n+    private usersService: UsersService,\n+    private jwtService: JwtService, \n+  ) {}\n+\n+  async login(email: string, pass: string) {\n+\n+    const user = await this.usersService.findOneByEmail(email);\n+    \n+    if (!user) {\n+       throw new UnauthorizedException('کاربر پیدا نشد');\n+    }\n+\n+    const isMatch = await bcrypt.compare(pass, user.password);\n+\n+    if (!isMatch) {\n+      throw new UnauthorizedException('رمز عبور اشتباه است');\n+    }\n+\n+    // ساختن توکن (کارت ورود)\n+    const payload = { sub: user.id, email: user.email }; // اطلاعاتی که توی توکن مخفی میشه\n+    \n+    return {\n+      access_token: await this.jwtService.signAsync(payload),\n+      user: {\n+        name: user.name,\n+        family: user.family,\n+        email: user.email\n+      }\n+    };\n+  }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771052923962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n import { Injectable } from '@nestjs/common';\n \n-@Injectable()\n+\n export class AuthService {}\n import { Injectable, UnauthorizedException } from '@nestjs/common';\n import { UsersService } from '../users/users.service';\n import { JwtService } from '@nestjs/jwt'; // اضافه کردن این\n@@ -40,49 +40,5 @@\n         email: user.email\n       }\n     };\n   }\n-}\n-import { Injectable } from '@nestjs/common';\n-\n-@Injectable()\n-export class AuthService {}\n-import { Injectable, UnauthorizedException } from '@nestjs/common';\n-import { UsersService } from '../users/users.service';\n-import { JwtService } from '@nestjs/jwt'; // اضافه کردن این\n-import * as bcrypt from 'bcrypt';\n-\n-@Injectable()\n-export class AuthService {\n-\n-  constructor(\n-    private usersService: UsersService,\n-    private jwtService: JwtService, \n-  ) {}\n-\n-  async login(email: string, pass: string) {\n-\n-    const user = await this.usersService.findOneByEmail(email);\n-    \n-    if (!user) {\n-       throw new UnauthorizedException('کاربر پیدا نشد');\n-    }\n-\n-    const isMatch = await bcrypt.compare(pass, user.password);\n-    \n-    if (!isMatch) {\n-      throw new UnauthorizedException('رمز عبور اشتباه است');\n-    }\n-\n-    // ۲. ساختن توکن (کارت ورود)\n-    const payload = { sub: user.id, email: user.email }; // اطلاعاتی که توی توکن مخفی میشه\n-    \n-    return {\n-      access_token: await this.jwtService.signAsync(payload),\n-      user: {\n-        name: user.name,\n-        family: user.family,\n-        email: user.email\n-      }\n-    };\n-  }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771052935066,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,6 @@\n import { Injectable } from '@nestjs/common';\n \n-\n-export class AuthService {}\n import { Injectable, UnauthorizedException } from '@nestjs/common';\n import { UsersService } from '../users/users.service';\n import { JwtService } from '@nestjs/jwt'; // اضافه کردن این\n import * as bcrypt from 'bcrypt';\n"
                },
                {
                    "date": 1771052954439,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,35 +1,29 @@\n-import { Injectable } from '@nestjs/common';\n-\n import { Injectable, UnauthorizedException } from '@nestjs/common';\n import { UsersService } from '../users/users.service';\n-import { JwtService } from '@nestjs/jwt'; // اضافه کردن این\n+import { JwtService } from '@nestjs/jwt';\n import * as bcrypt from 'bcrypt';\n \n @Injectable()\n export class AuthService {\n-\n   constructor(\n     private usersService: UsersService,\n-    private jwtService: JwtService, \n+    private jwtService: JwtService,\n   ) {}\n \n   async login(email: string, pass: string) {\n-\n     const user = await this.usersService.findOneByEmail(email);\n     \n     if (!user) {\n        throw new UnauthorizedException('کاربر پیدا نشد');\n     }\n \n     const isMatch = await bcrypt.compare(pass, user.password);\n-\n     if (!isMatch) {\n       throw new UnauthorizedException('رمز عبور اشتباه است');\n     }\n \n-    // ساختن توکن (کارت ورود)\n-    const payload = { sub: user.id, email: user.email }; // اطلاعاتی که توی توکن مخفی میشه\n+    const payload = { sub: user.id, email: user.email };\n     \n     return {\n       access_token: await this.jwtService.signAsync(payload),\n       user: {\n"
                },
                {
                    "date": 1771068785923,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,9 @@\n     private jwtService: JwtService,\n   ) {}\n \n   async login(email: string, pass: string) {\n+    \n     const user = await this.usersService.findOneByEmail(email);\n     \n     if (!user) {\n        throw new UnauthorizedException('کاربر پیدا نشد');\n"
                },
                {
                    "date": 1771068805871,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,9 @@\n     private jwtService: JwtService,\n   ) {}\n \n   async login(email: string, pass: string) {\n-    \n+\n     const user = await this.usersService.findOneByEmail(email);\n     \n     if (!user) {\n        throw new UnauthorizedException('کاربر پیدا نشد');\n@@ -33,5 +33,7 @@\n         email: user.email\n       }\n     };\n   }\n+\n+  \n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068829907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,47 @@\n+import { Injectable, UnauthorizedException } from '@nestjs/common';\n+import { UsersService } from '../users/users.service';\n+import { JwtService } from '@nestjs/jwt';\n+import * as bcrypt from 'bcrypt';\n+\n+@Injectable()\n+export class AuthService {\n+  constructor(\n+    private usersService: UsersService,\n+    private jwtService: JwtService,\n+  ) {}\n+\n+  async login(email: string, pass: string) {\n+\n+    const user = await this.usersService.findOneByEmail(email);\n+    \n+    if (!user) {\n+       throw new UnauthorizedException('کاربر پیدا نشد');\n+    }\n+\n+    const isMatch = await bcrypt.compare(pass, user.password);\n+    if (!isMatch) {\n+      throw new UnauthorizedException('رمز عبور اشتباه است');\n+    }\n+\n+    const payload = { sub: user.id, email: user.email };\n+    \n+    return {\n+      access_token: await this.jwtService.signAsync(payload),\n+      user: {\n+        name: user.name,\n+        family: user.family,\n+        email: user.email\n+      }\n+    };\n+  }\n+\n+      async register(username: string, email: string, password: string) {\n+      const existingUser = await this.usersService.findByEmail(email);\n+      if (existingUser) {\n+        throw new BadRequestException('Email already in use');\n+      }\n+\n+      const hashedPassword = await bcrypt.hash(password, 10);\n+      return this.usersService.create({ username, email, password: hashedPassword });\n+    }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068862231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,53 +34,14 @@\n       }\n     };\n   }\n \n-      async register(username: string, email: string, password: string) {\n-      const existingUser = await this.usersService.findByEmail(email);\n-      if (existingUser) {\n-        throw new BadRequestException('Email already in use');\n-      }\n+async register(username: string, email: string, password: string) {\n+const existingUser = await this.usersService.findByEmail(email);\n+if (existingUser) {\n+  throw new BadRequestException('Email already in use');\n+}\n \n-      const hashedPassword = await bcrypt.hash(password, 10);\n-      return this.usersService.create({ username, email, password: hashedPassword });\n-    }\n+const hashedPassword = await bcrypt.hash(password, 10);\n+return this.usersService.create({ username, email, password: hashedPassword });\n }\n-import { Injectable, UnauthorizedException } from '@nestjs/common';\n-import { UsersService } from '../users/users.service';\n-import { JwtService } from '@nestjs/jwt';\n-import * as bcrypt from 'bcrypt';\n-\n-@Injectable()\n-export class AuthService {\n-  constructor(\n-    private usersService: UsersService,\n-    private jwtService: JwtService,\n-  ) {}\n-\n-  async login(email: string, pass: string) {\n-\n-    const user = await this.usersService.findOneByEmail(email);\n-    \n-    if (!user) {\n-       throw new UnauthorizedException('کاربر پیدا نشد');\n-    }\n-\n-    const isMatch = await bcrypt.compare(pass, user.password);\n-    if (!isMatch) {\n-      throw new UnauthorizedException('رمز عبور اشتباه است');\n-    }\n-\n-    const payload = { sub: user.id, email: user.email };\n-    \n-    return {\n-      access_token: await this.jwtService.signAsync(payload),\n-      user: {\n-        name: user.name,\n-        family: user.family,\n-        email: user.email\n-      }\n-    };\n-  }\n-\n-  \n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068877776,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,13 +35,13 @@\n     };\n   }\n \n async register(username: string, email: string, password: string) {\n-const existingUser = await this.usersService.findByEmail(email);\n-if (existingUser) {\n-  throw new BadRequestException('Email already in use');\n-}\n+  const existingUser = await this.usersService.findByEmail(email);\n+  if (existingUser) {\n+    throw new BadRequestException('Email already in use');\n+  }\n \n-const hashedPassword = await bcrypt.hash(password, 10);\n-return this.usersService.create({ username, email, password: hashedPassword });\n-}\n+  const hashedPassword = await bcrypt.hash(password, 10);\n+  return this.usersService.create({ username, email, password: hashedPassword });\n+  }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068884720,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,6 +42,6 @@\n   }\n \n   const hashedPassword = await bcrypt.hash(password, 10);\n   return this.usersService.create({ username, email, password: hashedPassword });\n-  }\n+}\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068913663,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,7 +41,7 @@\n     throw new BadRequestException('Email already in use');\n   }\n \n   const hashedPassword = await bcrypt.hash(password, 10);\n-  return this.usersService.create({ username, email, password: hashedPassword });\n+  return this.usersService.create({ name, email, password: hashedPassword });\n }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068919250,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,7 +41,7 @@\n     throw new BadRequestException('Email already in use');\n   }\n \n   const hashedPassword = await bcrypt.hash(password, 10);\n-  return this.usersService.create({ name, email, password: hashedPassword });\n+  return this.usersService.create({ name,family, email, password: hashedPassword });\n }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771068956743,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,8 +35,9 @@\n     };\n   }\n \n async register(username: string, email: string, password: string) {\n+  \n   const existingUser = await this.usersService.findByEmail(email);\n   if (existingUser) {\n     throw new BadRequestException('Email already in use');\n   }\n"
                },
                {
                    "date": 1771069431996,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,10 +34,10 @@\n       }\n     };\n   }\n \n-async register(username: string, email: string, password: string) {\n-  \n+async register(name: string, email: string, password: string) {\n+\n   const existingUser = await this.usersService.findByEmail(email);\n   if (existingUser) {\n     throw new BadRequestException('Email already in use');\n   }\n"
                },
                {
                    "date": 1771069440508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,9 +34,9 @@\n       }\n     };\n   }\n \n-async register(name: string, email: string, password: string) {\n+async register(name: string, family: email: string, password: string) {\n \n   const existingUser = await this.usersService.findByEmail(email);\n   if (existingUser) {\n     throw new BadRequestException('Email already in use');\n"
                },
                {
                    "date": 1771070246837,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,48 +0,0 @@\n-import { Injectable, UnauthorizedException } from '@nestjs/common';\n-import { UsersService } from '../users/users.service';\n-import { JwtService } from '@nestjs/jwt';\n-import * as bcrypt from 'bcrypt';\n-\n-@Injectable()\n-export class AuthService {\n-  constructor(\n-    private usersService: UsersService,\n-    private jwtService: JwtService,\n-  ) {}\n-\n-  async login(email: string, pass: string) {\n-\n-    const user = await this.usersService.findOneByEmail(email);\n-    \n-    if (!user) {\n-       throw new UnauthorizedException('کاربر پیدا نشد');\n-    }\n-\n-    const isMatch = await bcrypt.compare(pass, user.password);\n-    if (!isMatch) {\n-      throw new UnauthorizedException('رمز عبور اشتباه است');\n-    }\n-\n-    const payload = { sub: user.id, email: user.email };\n-    \n-    return {\n-      access_token: await this.jwtService.signAsync(payload),\n-      user: {\n-        name: user.name,\n-        family: user.family,\n-        email: user.email\n-      }\n-    };\n-  }\n-\n-async register(name: string, family: email: string, password: string) {\n-\n-  const existingUser = await this.usersService.findByEmail(email);\n-  if (existingUser) {\n-    throw new BadRequestException('Email already in use');\n-  }\n-\n-  const hashedPassword = await bcrypt.hash(password, 10);\n-  return this.usersService.create({ name,family, email, password: hashedPassword });\n-}\n-}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771075788624,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,29 @@\n+import { Injectable, BadRequestException } from '@nestjs/common';\n+import { UsersService } from '../users/users.service';\n+import { RegisterDto } from './dto/register.dto';\n+import * as bcrypt from 'bcrypt';\n+\n+@Injectable()\n+export class AuthService {\n+  constructor(private readonly usersService: UsersService) {}\n+\n+  async register(dto: RegisterDto) {\n+    // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n+    const userExists = await this.usersService.findByEmail(dto.email);\n+    if (userExists) {\n+      throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n+    }\n+\n+    // ۲. هش کردن پسورد (Password Security)\n+    const salt = await bcrypt.genSalt(10);\n+    const hashedPassword = await bcrypt.hash(dto.password, salt);\n+\n+    // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n+    return this.usersService.create({\n+      name: dto.name,\n+      family: dto.family,\n+      email: dto.email,\n+      password: hashedPassword,\n+    });\n+  }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771075943906,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,8 @@\n     // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n-    // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n     return this.usersService.create({\n       name: dto.name,\n       family: dto.family,\n       email: dto.email,\n"
                },
                {
                    "date": 1771075952876,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,15 +7,14 @@\n export class AuthService {\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n-    // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n+\n     const userExists = await this.usersService.findByEmail(dto.email);\n     if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n     }\n \n-    // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n     return this.usersService.create({\n"
                },
                {
                    "date": 1771075964241,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,17 +7,19 @@\n export class AuthService {\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n-\n+    // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n     const userExists = await this.usersService.findByEmail(dto.email);\n     if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n     }\n \n+    // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n+    // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n     return this.usersService.create({\n       name: dto.name,\n       family: dto.family,\n       email: dto.email,\n"
                },
                {
                    "date": 1771075971872,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,8 @@\n     // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n-    // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n     return this.usersService.create({\n       name: dto.name,\n       family: dto.family,\n       email: dto.email,\n"
                },
                {
                    "date": 1771075978279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,27 @@\n+import { Injectable, BadRequestException } from '@nestjs/common';\n+import { UsersService } from '../users/users.service';\n+import { RegisterDto } from './dto/register.dto';\n+import * as bcrypt from 'bcrypt';\n+\n+@Injectable()\n+export class AuthService {\n+  constructor(private readonly usersService: UsersService) {}\n+\n+  async register(dto: RegisterDto) {\n+\n+    const userExists = await this.usersService.findByEmail(dto.email);\n+    if (userExists) {\n+      throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n+    }\n+\n+    const salt = await bcrypt.genSalt(10);\n+    const hashedPassword = await bcrypt.hash(dto.password, salt);\n+\n+    return this.usersService.create({\n+      name: dto.name,\n+      family: dto.family,\n+      email: dto.email,\n+      password: hashedPassword,\n+    });\n+  }\n+}\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771075983850,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,35 +7,8 @@\n export class AuthService {\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n-\n-    const userExists = await this.usersService.findByEmail(dto.email);\n-    if (userExists) {\n-      throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n-    }\n-\n-    const salt = await bcrypt.genSalt(10);\n-    const hashedPassword = await bcrypt.hash(dto.password, salt);\n-\n-    return this.usersService.create({\n-      name: dto.name,\n-      family: dto.family,\n-      email: dto.email,\n-      password: hashedPassword,\n-    });\n-  }\n-}\n-import { Injectable, BadRequestException } from '@nestjs/common';\n-import { UsersService } from '../users/users.service';\n-import { RegisterDto } from './dto/register.dto';\n-import * as bcrypt from 'bcrypt';\n-\n-@Injectable()\n-export class AuthService {\n-  constructor(private readonly usersService: UsersService) {}\n-\n-  async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n     const userExists = await this.usersService.findByEmail(dto.email);\n     if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n@@ -44,8 +17,9 @@\n     // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n+    // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n     return this.usersService.create({\n       name: dto.name,\n       family: dto.family,\n       email: dto.email,\n"
                },
                {
                    "date": 1771080505314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,10 +8,9 @@\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n-    const userExists = await this.usersService.findByEmail(dto.email);\n-    if (userExists) {\n+const userExists = await this.usersService.findOneByEmail(dto.email);    if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n     }\n \n     // ۲. هش کردن پسورد (Password Security)\n"
                },
                {
                    "date": 1771080514575,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,10 @@\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n-const userExists = await this.usersService.findOneByEmail(dto.email);    if (userExists) {\n+const userExists = await this.usersService.findOneByEmail(dto.email);\n+    if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n     }\n \n     // ۲. هش کردن پسورد (Password Security)\n"
                },
                {
                    "date": 1771080522335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,10 @@\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n-const userExists = await this.usersService.findOneByEmail(dto.email);\n+    const userExists = await this.usersService.findByEmail(dto.email);\n+    const userExists = await this.usersService.findOneByEmail(dto.email);\n     if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n     }\n \n"
                },
                {
                    "date": 1771080529421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,8 @@\n   constructor(private readonly usersService: UsersService) {}\n \n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n-    const userExists = await this.usersService.findByEmail(dto.email);\n     const userExists = await this.usersService.findOneByEmail(dto.email);\n     if (userExists) {\n       throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n     }\n"
                },
                {
                    "date": 1771086897537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,10 +9,13 @@\n \n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n     const userExists = await this.usersService.findOneByEmail(dto.email);\n+\n     if (userExists) {\n-      throw new BadRequestException('این ایمیل قبلاً در سیستم ثبت شده است');\n+      throw new BadRequestException(}\n+        \n+      );\n     }\n \n     // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n"
                },
                {
                    "date": 1771086922255,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,14 +10,15 @@\n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n     const userExists = await this.usersService.findOneByEmail(dto.email);\n \n-    if (userExists) {\n-      throw new BadRequestException(}\n-        \n-      );\n-    }\n-\n+if (userExists) {\n+    throw new BadRequestException({\n+      success: false,\n+      statusCode: 400,\n+      message: 'این ایمیل قبلاً ثبت شده است',\n+    });\n+  }\n     // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n"
                },
                {
                    "date": 1771086985362,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,19 +10,26 @@\n   async register(dto: RegisterDto) {\n     // ۱. بررسی تکراری نبودن ایمیل (Security Check)\n     const userExists = await this.usersService.findOneByEmail(dto.email);\n \n-if (userExists) {\n-    throw new BadRequestException({\n-      success: false,\n-      statusCode: 400,\n-      message: 'این ایمیل قبلاً ثبت شده است',\n-    });\n-  }\n+    if (userExists) {\n+        throw new BadRequestException({\n+        success: false,\n+        statusCode: 400,\n+        message: 'این ایمیل قبلاً ثبت شده است',\n+        });\n+    }\n     // ۲. هش کردن پسورد (Password Security)\n     const salt = await bcrypt.genSalt(10);\n     const hashedPassword = await bcrypt.hash(dto.password, salt);\n \n+    const user = await this.usersService.create({\n+    name: dto.name,\n+    family: dto.family,\n+    email: dto.email,\n+    password: hashedPassword,\n+  });\n+\n     // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n     return this.usersService.create({\n       name: dto.name,\n       family: dto.family,\n"
                },
                {
                    "date": 1771087009759,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,13 +28,15 @@\n     email: dto.email,\n     password: hashedPassword,\n   });\n \n-    // ۳. ذخیره کاربر در دیتابیس با فیلدهای صحیح تو\n-    return this.usersService.create({\n-      name: dto.name,\n-      family: dto.family,\n-      email: dto.email,\n-      password: hashedPassword,\n-    });\n+ const { password, ...result } = user;\n+\n+  return {\n+    success: true,\n+    statusCode: 201,\n+    message: 'ثبت‌نام با موفقیت انجام شد',\n+    data: result,\n+    timestamp: new Date().toISOString(),\n+  };\n   }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771087059711,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,9 +27,9 @@\n     family: dto.family,\n     email: dto.email,\n     password: hashedPassword,\n   });\n-\n+// حذف پسورد از دیتای ارسالی به فرانت (امنیت!)\n  const { password, ...result } = user;\n \n   return {\n     success: true,\n"
                },
                {
                    "date": 1771095455593,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,16 +27,14 @@\n     family: dto.family,\n     email: dto.email,\n     password: hashedPassword,\n   });\n+\n // حذف پسورد از دیتای ارسالی به فرانت (امنیت!)\n  const { password, ...result } = user;\n \n   return {\n-    success: true,\n-    statusCode: 201,\n-    message: 'ثبت‌نام با موفقیت انجام شد',\n-    data: result,\n-    timestamp: new Date().toISOString(),\n+message: 'ثبت‌نام با موفقیت انجام شد',\n+      data: result,\n   };\n   }\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1771095461561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,9 +32,9 @@\n // حذف پسورد از دیتای ارسالی به فرانت (امنیت!)\n  const { password, ...result } = user;\n \n   return {\n-message: 'ثبت‌نام با موفقیت انجام شد',\n+    message: 'ثبت‌نام با موفقیت انجام شد',\n       data: result,\n   };\n   }\n }\n\\ No newline at end of file\n"
                }
            ],
            "date": 1770977950256,
            "name": "Commit-0",
            "content": "import { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class AuthService {}\nimport { Injectable, UnauthorizedException } from '@nestjs/common';\nimport { UsersService } from '../users/users.service';\nimport { JwtService } from '@nestjs/jwt'; // اضافه کردن این\nimport * as bcrypt from 'bcrypt';\n\n@Injectable()\nexport class AuthService {\n  constructor(\n    private usersService: UsersService,\n    private jwtService: JwtService, // تزریق سرویس JWT\n  ) {}\n\n  async login(email: string, pass: string) {\n    // ۱. چک کردن یوزر و پسورد\n    const user = await this.usersService.findOneByEmail(email);\n    \n    if (!user) {\n       throw new UnauthorizedException('کاربر پیدا نشد');\n    }\n\n    const isMatch = await bcrypt.compare(pass, user.password);\n    if (!isMatch) {\n      throw new UnauthorizedException('رمز عبور اشتباه است');\n    }\n\n    // ۲. ساختن توکن (کارت ورود)\n    const payload = { sub: user.id, email: user.email }; // اطلاعاتی که توی توکن مخفی میشه\n    \n    return {\n      access_token: await this.jwtService.signAsync(payload),\n      user: {\n        name: user.name,\n        family: user.family,\n        email: user.email\n      }\n    };\n  }\n}"
        }
    ]
}